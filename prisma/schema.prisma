generator client {
  provider = "prisma-client-js"
  previewFeatures = ["referentialIntegrity"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
  referentialIntegrity = "prisma"
}

enum State {
  PENDING
  IN_PROGRESS
  FINISHED
  CANCELED
}

model User {
  id        Int      @id @default(autoincrement())
  email  String   @unique
  password  String
  role Role @relation(fields: [roleId], references: [id])
  roleId Int
  company Company @relation(fields: [companyId], references: [id])
  companyId Int @default(1)
  clients Client[]
  @@index([roleId])
  @@index([companyId])
}

model Role {
  id        Int      @id @default(autoincrement())
  name  String   @unique
  users User[]
}

model Company {
  id        Int      @id @default(autoincrement())
  name  String   @unique
  users User[]
}

model Client {
  id        Int      @id @default(autoincrement())
  firstName  String
  lastName  String
  cellPhone  String
  email  String
  owner User @relation(fields: [ownerId], references: [id])
  ownerId Int
  processes Process[]
  @@index([ownerId])
}

model Source {
  id        Int      @id @default(autoincrement())
  name  String   @unique
  order Int
  indicators Indicator[]
}

model Indicator {
  id        Int      @id @default(autoincrement())
  name  String   @unique
  order Int
  source Source @relation(fields: [sourceId], references: [id])
  sourceId Int
  characteristics Characteristic[]
  @@index([sourceId])
}

model Characteristic {
  id        Int      @id @default(autoincrement())
  name  String   @unique
  order Int
  
  indicators Indicator[]
}

model Process {
  id        Int      @id @default(autoincrement())
  name  String   @unique @default(uuid())
  description  String
  state State
  client Client @relation(fields: [clientId], references: [id])
  clientId Int
  @@index([clientId])
  steps Step[]
}

model Step {
  id        Int      @id @default(autoincrement())
  name  String   @unique
  description  String
  order Int
  process Process @relation(fields: [processId], references: [id])
  processId Int
  @@index([processId])
}

